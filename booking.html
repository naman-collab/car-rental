<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Book Your Car - CarRental</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial}
body{background:#0c0c0c;color:white;padding-top:80px}

/* NAVBAR */
nav{
position:fixed;top:0;left:0;width:100%;
background:black;padding:15px 40px;
display:flex;justify-content:space-between;align-items:center;
border-bottom:2px solid gold;z-index:1000;
}
nav h2{color:gold}

/* CONTAINER */
.container{
width:90%;max-width:520px;
background:#111;margin:20px auto;
padding:25px;border-radius:12px;
border:2px solid gold;
animation:fadeIn .6s ease;
}
.container h1{text-align:center;color:gold}

/* PROGRESS BAR */
.progress{height:8px;background:#222;border-radius:10px;overflow:hidden;margin-bottom:20px}
.progress-bar{
height:100%;width:33%;
background:linear-gradient(90deg,gold,orange);
transition:.4s ease;
}

/* FORM */
label{display:block;margin-top:12px;color:gold;font-size:14px}
input,select{
width:100%;padding:12px;margin-top:6px;
background:black;color:white;
border:1px solid #444;border-radius:5px;
transition:.3s;
}
input.error,select.error{border-color:red}

/* BUTTONS */
button{
width:100%;margin-top:15px;padding:12px;
background:red;color:white;border:none;
border-radius:6px;font-size:18px;cursor:pointer;
transition:.3s;
}
button.secondary{background:#333}
button:hover{transform:translateY(-2px);opacity:.9}

/* STEPS */
.step{display:none;animation:slide .5s ease}
.step.active{display:block}

/* CAR PREVIEW */
.car-preview{
margin-top:10px;border:2px solid gold;
border-radius:8px;overflow:hidden;display:none;
animation:zoom .5s ease;
}
.car-preview img{width:100%;height:200px;object-fit:cover}

/* MAP */
.map-box{margin-top:10px;border:2px solid gold;border-radius:8px;overflow:hidden}
iframe{width:100%;height:220px;border:0}

/* INFO BOX */
#priceBox,#remainingBox,#bookingResult,#printArea{
display:none;background:#000;padding:12px;
border:1px solid gold;border-radius:8px;
margin-top:12px;
animation:fadeUp .5s ease;
}
.success{color:lightgreen;text-align:center;margin-top:10px}

/* PRINT */
@media print{
body *{visibility:hidden}
#printArea, #printArea *{visibility:visible}
#printArea{position:absolute;top:0;left:0;width:100%}
}

/* ANIMATIONS */
@keyframes slide{from{opacity:0;transform:translateX(20px)}to{opacity:1;transform:none}}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}
@keyframes zoom{from{transform:scale(.9)}to{transform:scale(1)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
</style>
</head>

<body>

<nav><h2>CarRental</h2></nav>

<div class="container">
<h1>Book Your Car</h1>

<div class="progress"><div class="progress-bar" id="progressBar"></div></div>

<!-- STEP 1 -->
<div class="step active" id="step1">
<label>Name</label>
<input id="name" data-req>
<label>Phone</label>
<input id="phone" data-req>
<button onclick="nextStep(1)">Next</button>
</div>

<!-- STEP 2 -->
<div class="step" id="step2">
<label>Select Car</label>
<select id="carSelect" onchange="calculatePrice()" data-req>
<option value="">-- Select Car --</option>
<option value="Scorpio">Scorpio</option>
<option value="Fortuner">Fortuner</option>
<option value="Thar">Thar</option>
<option value="Defender">Defender</option>
<option value="Verna">Verna</option>
</select>

<div class="car-preview" id="carPreview"><img id="carImg"></div>

<label>Pickup Location</label>
<input id="pickupLocation" onkeyup="updateMaps()" data-req>

<label>Drop Location</label>
<input id="dropLocation" onkeyup="updateMaps()" data-req>

<div class="map-box">
<iframe id="routeMap" src="https://www.google.com/maps?q=India&output=embed"></iframe>
</div>

<button class="secondary" onclick="prevStep(2)">Back</button>
<button onclick="nextStep(2)">Next</button>
</div>

<!-- STEP 3 -->
<div class="step" id="step3">
<label>Pickup Date</label>
<input type="date" id="pickupDate" onchange="calculatePrice()" data-req>

<label>Drop Date</label>
<input type="date" id="dropDate" onchange="calculatePrice()" data-req>

<label>Estimated KM</label>
<input id="km" onchange="calculatePrice()">

<label>Advance Paid (â‚¹)</label>
<input id="advance" onkeyup="calculateRemaining()">

<div id="priceBox">
<p>Per Day: <b id="perDay"></b></p>
<p>Total Days: <b id="days"></b></p>
<p>Extra KM Charge: <b id="extraKm"></b></p>
<p style="color:gold;font-size:18px">Total Amount: <b id="total"></b></p>
</div>

<div id="remainingBox">
<p>Advance Paid: <b id="advShow"></b></p>
<p style="color:gold">Remaining Amount: <b id="remainingAmt"></b></p>
</div>

<button class="secondary" onclick="prevStep(3)">Back</button>
<button onclick="sendBooking()">Submit Booking</button>
<div class="success" id="successMessage"></div>
</div>

<hr style="margin:25px 0;border:1px solid gold">

<h2 style="color:gold;text-align:center">Check Booking</h2>
<input id="searchBookingId" placeholder="Enter Booking ID">
<button onclick="findBooking()">Check Booking</button>
<div id="bookingResult"></div>

<!-- RECEIPT -->
<div id="printArea">
<h3 style="color:gold">Booking Receipt</h3>
<div id="receiptText"></div>
<button onclick="window.print()">ðŸ–¨ Print Receipt</button>
</div>

</div>

<script>
/* DATA */
const carData={
Scorpio:{price:3500,img:"Scorpio N.jpeg"},
Fortuner:{price:5000,img:"Toyota Fortuner GR Sport.jpeg"},
Thar:{price:3000,img:"thar.jpeg"},
Defender:{price:9000,img:"defender.jpeg"},
Verna:{price:2500,img:"Verna black snap.jpeg"}
};

/* PROGRESS */
function updateProgress(step){
progressBar.style.width = step===1?"33%":step===2?"66%":"100%";
}

/* STEP */
function nextStep(n){
if(!softValidate(document.getElementById("step"+n)))return;
document.getElementById("step"+n).classList.remove("active");
document.getElementById("step"+(n+1)).classList.add("active");
updateProgress(n+1);
}
function prevStep(n){
document.getElementById("step"+n).classList.remove("active");
document.getElementById("step"+(n-1)).classList.add("active");
updateProgress(n-1);
}

/* SOFT VALIDATION */
function softValidate(step){
let ok=true;
step.querySelectorAll("[data-req]").forEach(el=>{
el.classList.toggle("error",!el.value);
if(!el.value) ok=false;
});
return ok;
}

/* MAP */
function updateMaps(){
if(pickupLocation.value.length>3 && dropLocation.value.length>3){
routeMap.src="https://www.google.com/maps?saddr="+
encodeURIComponent(pickupLocation.value)+"&daddr="+
encodeURIComponent(dropLocation.value)+"&output=embed";
}
}

/* PRICE */
function calculatePrice(){
let car=carSelect.value;
if(!car) return;

carImg.src=carData[car].img;
carPreview.style.display="block";

if(!pickupDate.value||!dropDate.value) return;

let daysCount=Math.ceil(
(new Date(dropDate.value)-new Date(pickupDate.value)) /
(1000*60*60*24)
);
if(daysCount<=0) return;

let base=daysCount*carData[car].price;
let kmVal=parseInt(km.value||0);
let freeKm=daysCount*300;
let extra=kmVal>freeKm?(kmVal-freeKm)*10:0;
let totalAmt=base+extra;

priceBox.style.display="block";
perDay.innerText="â‚¹"+carData[car].price;
days.innerText=daysCount;
extraKm.innerText="â‚¹"+extra;
total.innerText="â‚¹"+totalAmt;

calculateRemaining();
}

function calculateRemaining(){
let adv=parseInt(advance.value||0);
let tot=parseInt(total.innerText.replace("â‚¹","")||0);
let rem=tot-adv;
remainingBox.style.display="block";
advShow.innerText="â‚¹"+adv;
remainingAmt.innerText="â‚¹"+(rem<0?0:rem);
}

/* BOOKING ID */
function generateBookingId(car){
return "CR-"+car.substring(0,3).toUpperCase()+"-"+Math.floor(1000+Math.random()*9000);
}

/* SUBMIT + WHATSAPP + PRINT */
function sendBooking(){

/* âœ… FIX-1: name undefined issue */
let customerName = document.getElementById("name").value;

/* phone */
let phoneNum = document.getElementById("phone").value.replace(/\D/g,"");

let bookingId=generateBookingId(carSelect.value);

let msg=
`ðŸš— *CarRental â€“ Booking Confirmation*

ðŸ†” Booking ID: ${bookingId}

ðŸ‘¤ Name: ${customerName}
ðŸ“ž Phone: ${phoneNum}

ðŸš˜ Car: ${carSelect.value}

ðŸ“ Pickup: ${pickupLocation.value}
ðŸ“ Drop: ${dropLocation.value}

ðŸ’° Total: ${total.innerText}
ðŸ’³ Advance: ${advShow.innerText}
ðŸ’µ Remaining: ${remainingAmt.innerText}

Thank you for choosing *CarRental*
Have a safe journey ðŸš˜âœ¨`;

localStorage.setItem("booking_"+bookingId,JSON.stringify({
bookingId,
name:customerName,
car:carSelect.value,
pickup:pickupLocation.value,
drop:dropLocation.value,
total:total.innerText
}));

/* WhatsApp to SAME number user entered */
window.open(
"https://wa.me/91"+phoneNum+"?text="+encodeURIComponent(msg),
"_blank"
);

/* UI updates */
successMessage.innerText="Booking Successful! Booking ID: "+bookingId;

/* âœ… FIX-2: Print enable */
printArea.style.display="block";
receiptText.innerHTML=msg.replace(/\n/g,"<br>");
}

/* SEARCH */
function findBooking(){
let data=localStorage.getItem("booking_"+searchBookingId.value.trim());
if(!data)return alert("Booking not found");
let b=JSON.parse(data);
bookingResult.style.display="block";
bookingResult.innerHTML=
`<b>Booking ID:</b> ${b.bookingId}<br>
<b>Name:</b> ${b.name}<br>
<b>Car:</b> ${b.car}<br>
<b>Pickup:</b> ${b.pickup}<br>
<b>Drop:</b> ${b.drop}<br>
<b>Total:</b> ${b.total}`;
}
</script>

</body>
</html>
